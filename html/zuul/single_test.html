<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>单节点网关测试</title>
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Wu, Shanliang" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="css/main.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="zuul_test.html"> UP </a>
 |
 <a accesskey="H" href="zuul_test.html"> HOME </a>
</div><div id="content">
<h1 class="title">单节点网关测试</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">测试环境</a></li>
<li><a href="#sec-2">hello world服务测试</a>
<ul>
<li><a href="#sec-2-1">网关自身提供hello world服务</a></li>
<li><a href="#sec-2-2">自动注册应用提供hello world服务，无auth认证</a></li>
<li><a href="#sec-2-3">自动注册应用提供hello world服务，oauth认证</a></li>
<li><a href="#sec-2-4">数据库精确匹配路由hello world服务, 无auth认证</a></li>
<li><a href="#sec-2-5">数据库精确匹配路由hello world服务, 缓存Oauth认证结果</a></li>
<li><a href="#sec-2-6">数据库模糊路径匹配路由hello world服务, 无安全认证</a></li>
<li><a href="#sec-2-7">数据库模糊路径匹配路由hello world服务, 缓存Oauth认证结果</a></li>
</ul>
</li>
<li><a href="#sec-3">业务应用测试</a>
<ul>
<li><a href="#sec-3-1">直接调用后台/portal/products</a></li>
<li><a href="#sec-3-2">网关优化前调用/portal/products</a></li>
<li><a href="#sec-3-3">网关优化后调用/portal/products</a></li>
</ul>
</li>
<li><a href="#sec-4">单节点测试总结</a></li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">测试环境</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>主机：172.25.17.74
</li>
<li>硬件：8核16G内存
</li>
<li>部署：网关，auth服务，api-key服务，portal-service等服务，内存消耗在6G左右
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">hello world服务测试</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">网关自身提供hello world服务</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">

<pre class="src src-sh">ab -t 100 -c 1 http://172.25.17.74:7070/hw 
ab -t 100 -c 2 http://172.25.17.74:7070/hw 
ab -t 100 -c 4 http://172.25.17.74:7070/hw 
ab -t 100 -c 8 http://172.25.17.74:7070/hw 
ab -t 100 -c 16 http://172.25.17.74:7070/hw
ab -t 100 -c 32 http://172.25.17.74:7070/hw
ab -t 100 -c 64 http://172.25.17.74:7070/hw
ab -t 100 -c 128 http://172.25.17.74:7070/hw
ab -t 100 -c 256 http://172.25.17.74:7070/hw
</pre>
</div>

<table border="1" cellspacing="0" cellpadding="6" rules="all" frame="boader">
<caption class="t-above"><span class="table-number">Table 1:</span> 网关自身提供hello world服务</caption>

<colgroup>
<col  class="left" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="left">指标</td>
<td class="right">1并发</td>
<td class="right">2并发</td>
<td class="right">4并发</td>
<td class="right">8并发</td>
<td class="right">16并发</td>
<td class="right">32并发</td>
<td class="right">64 并发</td>
<td class="right">128并发</td>
<td class="right">256并发</td>
</tr>

<tr>
<td class="left">发送总请求数</td>
<td class="right">21161</td>
<td class="right">36094</td>
<td class="right">41150</td>
<td class="right">41831</td>
<td class="right">41700</td>
<td class="right">41612</td>
<td class="right">41564</td>
<td class="right">41418</td>
<td class="right">41299</td>
</tr>

<tr>
<td class="left">总时间(s)</td>
<td class="right">100</td>
<td class="right">100</td>
<td class="right">100</td>
<td class="right">100</td>
<td class="right">100</td>
<td class="right">100</td>
<td class="right">100</td>
<td class="right">100</td>
<td class="right">100</td>
</tr>

<tr>
<td class="left">平均请求时间(ms)</td>
<td class="right">4.726</td>
<td class="right">5.541</td>
<td class="right">9.722</td>
<td class="right">19.125</td>
<td class="right">38.381</td>
<td class="right">76.901</td>
<td class="right">153.980</td>
<td class="right">309.110</td>
<td class="right">619.883</td>
</tr>

<tr>
<td class="left">请求时间中位数（50%&lt;)(ms)</td>
<td class="right">4</td>
<td class="right">4</td>
<td class="right">6</td>
<td class="right">12</td>
<td class="right">28</td>
<td class="right">83</td>
<td class="right">149</td>
<td class="right">326</td>
<td class="right">639</td>
</tr>

<tr>
<td class="left">请求时间90%&lt; (ms)</td>
<td class="right">4</td>
<td class="right">6</td>
<td class="right">11</td>
<td class="right">51</td>
<td class="right">75</td>
<td class="right">122</td>
<td class="right">270</td>
<td class="right">519</td>
<td class="right">938</td>
</tr>

<tr>
<td class="left">最大请求时间(ms)</td>
<td class="right">1037</td>
<td class="right">1037</td>
<td class="right">1044</td>
<td class="right">1064</td>
<td class="right">1083</td>
<td class="right">1153</td>
<td class="right">1257</td>
<td class="right">1556</td>
<td class="right">2205</td>
</tr>

<tr>
<td class="left">Error</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
</tr>

<tr>
<td class="left">QPS(请求数/秒)</td>
<td class="right">211.61</td>
<td class="right">360.94</td>
<td class="right">411.50</td>
<td class="right">418.31</td>
<td class="right">416.87</td>
<td class="right">416.12</td>
<td class="right">415.64</td>
<td class="right">414.18</td>
<td class="right">412.99</td>
</tr>
</tbody>
</table>

<p>
并发上不去的原因在于：高并发下日志打印太慢
</p>
<table border="1" cellspacing="0" cellpadding="6" rules="all" frame="boader">
<caption class="t-above"><span class="table-number">Table 2:</span> 修改打印日志级别后</caption>

<colgroup>
<col  class="left" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="left">指标</td>
<td class="right">1并发</td>
<td class="right">2并发</td>
<td class="right">4并发</td>
<td class="right">8并发</td>
<td class="right">16并发</td>
<td class="right">32并发</td>
<td class="right">64 并发</td>
<td class="right">128并发</td>
<td class="right">256并发</td>
</tr>

<tr>
<td class="left">发送总请求数</td>
<td class="right">23907</td>
<td class="right">47744</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
</tr>

<tr>
<td class="left">总时间(s)</td>
<td class="right">100</td>
<td class="right">100</td>
<td class="right">54.205</td>
<td class="right">65.171</td>
<td class="right">42.477</td>
<td class="right">26.819</td>
<td class="right">23.859</td>
<td class="right">23.820</td>
<td class="right">23.424</td>
</tr>

<tr>
<td class="left">平均请求时间(ms)</td>
<td class="right">4.190</td>
<td class="right">4.189</td>
<td class="right">4.336</td>
<td class="right">10.427</td>
<td class="right">13.593</td>
<td class="right">17.164</td>
<td class="right">30.540</td>
<td class="right">60.978</td>
<td class="right">119.929</td>
</tr>

<tr>
<td class="left">请求时间中位数（50%&lt;)(ms)</td>
<td class="right">3</td>
<td class="right">3</td>
<td class="right">3</td>
<td class="right">4</td>
<td class="right">6</td>
<td class="right">10</td>
<td class="right">13</td>
<td class="right">20</td>
<td class="right">49</td>
</tr>

<tr>
<td class="left">请求时间90%&lt; (ms)</td>
<td class="right">6</td>
<td class="right">6</td>
<td class="right">6</td>
<td class="right">11</td>
<td class="right">41</td>
<td class="right">35</td>
<td class="right">75</td>
<td class="right">159</td>
<td class="right">190</td>
</tr>

<tr>
<td class="left">最大请求时间(ms)</td>
<td class="right">1040</td>
<td class="right">1037</td>
<td class="right">1033</td>
<td class="right">1074</td>
<td class="right">1038</td>
<td class="right">1070</td>
<td class="right">1100</td>
<td class="right">2099</td>
<td class="right">1672</td>
</tr>

<tr>
<td class="left">Error</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
</tr>

<tr>
<td class="left">QPS</td>
<td class="right">238.69</td>
<td class="right">477.44</td>
<td class="right">922.43</td>
<td class="right">767.22</td>
<td class="right">1177.10</td>
<td class="right">1864.35</td>
<td class="right">2095.63</td>
<td class="right">2099.10</td>
<td class="right">2134.60</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">自动注册应用提供hello world服务，无auth认证</h3>
<div class="outline-text-3" id="text-2-2">
<table border="1" cellspacing="0" cellpadding="6" rules="all" frame="boader">
<caption class="t-above"><span class="table-number">Table 3:</span> 直接访问api key management应用hello world服务</caption>

<colgroup>
<col  class="left" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="left">指标</td>
<td class="right">1并发</td>
<td class="right">2并发</td>
<td class="right">4并发</td>
<td class="right">8并发</td>
<td class="right">16并发</td>
<td class="right">32并发</td>
<td class="right">64 并发</td>
<td class="right">128并发</td>
<td class="right">256并发</td>
</tr>

<tr>
<td class="left">发送总请求数</td>
<td class="right">32820</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
</tr>

<tr>
<td class="left">总时间(s)</td>
<td class="right">100.915</td>
<td class="right">79.015</td>
<td class="right">52.931</td>
<td class="right">65.635</td>
<td class="right">38.096</td>
<td class="right">24.777</td>
<td class="right">23.970</td>
<td class="right">23.884</td>
<td class="right">24.870</td>
</tr>

<tr>
<td class="left">平均请求时间(ms)</td>
<td class="right">3.075</td>
<td class="right">3.161</td>
<td class="right">4.235</td>
<td class="right">10.502</td>
<td class="right">12.191</td>
<td class="right">15.857</td>
<td class="right">30.682</td>
<td class="right">61.142</td>
<td class="right">127.334</td>
</tr>

<tr>
<td class="left">请求时间中位数（50%&lt;)(ms)</td>
<td class="right">3</td>
<td class="right">3</td>
<td class="right">3</td>
<td class="right">3</td>
<td class="right">5</td>
<td class="right">7</td>
<td class="right">9</td>
<td class="right">14</td>
<td class="right">41</td>
</tr>

<tr>
<td class="left">请求时间90%&lt; (ms)</td>
<td class="right">3</td>
<td class="right">4</td>
<td class="right">4</td>
<td class="right">20</td>
<td class="right">31</td>
<td class="right">36</td>
<td class="right">80</td>
<td class="right">171</td>
<td class="right">309</td>
</tr>

<tr>
<td class="left">最大请求时间(ms)</td>
<td class="right">1035</td>
<td class="right">1035</td>
<td class="right">1036</td>
<td class="right">1057</td>
<td class="right">1036</td>
<td class="right">1064</td>
<td class="right">1068</td>
<td class="right">1211</td>
<td class="right">1913</td>
</tr>

<tr>
<td class="left">Error</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
</tr>

<tr>
<td class="left">QPS(请求数/秒)</td>
<td class="right">325.23</td>
<td class="right">632.79</td>
<td class="right">944.62</td>
<td class="right">761.79</td>
<td class="right">1312.49</td>
<td class="right">2018.03</td>
<td class="right">2085.91</td>
<td class="right">2093.48</td>
<td class="right">2010.47</td>
</tr>
</tbody>
</table>

<div class="org-src-container">

<pre class="src src-sh">ab -t 100 -c 1 http://172.25.17.74:7070/akm-service/apiKey/hw 
ab -t 100 -c 2 http://172.25.17.74:7070/akm-service/apiKey/hw 
ab -t 100 -c 4 http://172.25.17.74:7070/akm-service/apiKey/hw 
ab -t 100 -c 8 http://172.25.17.74:7070/akm-service/apiKey/hw 
ab -t 100 -c 16 http://172.25.17.74:7070/akm-service/apiKey/hw 
ab -t 100 -c 32 http://172.25.17.74:7070/akm-service/apiKey/hw 
ab -t 100 -c 64 http://172.25.17.74:7070/akm-service/apiKey/hw 
ab -t 100 -c 128 http://172.25.17.74:7070/akm-service/apiKey/hw 
ab -t 100 -c 256 http://172.25.17.74:7070/akm-service/apiKey/hw
</pre>
</div>

<table border="1" cellspacing="0" cellpadding="6" rules="all" frame="boader">
<caption class="t-above"><span class="table-number">Table 4:</span> 通过网关访问自动注册的api key management应用hello world服务</caption>

<colgroup>
<col  class="left" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="left">指标</td>
<td class="right">1并发</td>
<td class="right">2并发</td>
<td class="right">4并发</td>
<td class="right">8并发</td>
<td class="right">16并发</td>
<td class="right">32并发</td>
<td class="right">64 并发</td>
<td class="right">128并发</td>
<td class="right">256并发</td>
</tr>

<tr>
<td class="left">发送总请求数</td>
<td class="right">14310</td>
<td class="right">40219</td>
<td class="right">43953</td>
<td class="right">41921</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">41020</td>
<td class="right">11363</td>
</tr>

<tr>
<td class="left">总时间(s)</td>
<td class="right">100.001</td>
<td class="right">100.001</td>
<td class="right">100.001</td>
<td class="right">100.024</td>
<td class="right">86.916</td>
<td class="right">49.743</td>
<td class="right">45.481</td>
<td class="right">103.918</td>
<td class="right">101.969</td>
</tr>

<tr>
<td class="left">平均请求时间(ms)</td>
<td class="right">6.988</td>
<td class="right">4.973</td>
<td class="right">9.101</td>
<td class="right">19.088</td>
<td class="right">27.813</td>
<td class="right">31.835</td>
<td class="right">58.216</td>
<td class="right">324.269</td>
<td class="right">2297.280</td>
</tr>

<tr>
<td class="left">请求时间中位数（50%&lt;)(ms)</td>
<td class="right">6</td>
<td class="right">5</td>
<td class="right">5</td>
<td class="right">7</td>
<td class="right">11</td>
<td class="right">15</td>
<td class="right">23</td>
<td class="right">27</td>
<td class="right">67</td>
</tr>

<tr>
<td class="left">请求时间90%&lt; (ms)</td>
<td class="right">9</td>
<td class="right">6</td>
<td class="right">8</td>
<td class="right">73</td>
<td class="right">77</td>
<td class="right">77</td>
<td class="right">130</td>
<td class="right">370</td>
<td class="right">5633</td>
</tr>

<tr>
<td class="left">最大请求时间(ms)</td>
<td class="right">1026</td>
<td class="right">1025</td>
<td class="right">1036</td>
<td class="right">1029</td>
<td class="right">1108</td>
<td class="right">1091</td>
<td class="right">2386</td>
<td class="right">5610</td>
<td class="right">16258</td>
</tr>

<tr>
<td class="left">Error</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">106</td>
<td class="right">7</td>
</tr>

<tr>
<td class="left">QPS(请求数/秒)</td>
<td class="right">143.10</td>
<td class="right">402.19</td>
<td class="right">439.53</td>
<td class="right">419.11</td>
<td class="right">575.27</td>
<td class="right">656.70</td>
<td class="right">1099.35</td>
<td class="right">394.73</td>
<td class="right">111.44</td>
</tr>
</tbody>
</table>

<p>
并发超过100以后，发现后台服务无法获得信号量，产生熔断异常
</p>

<pre class="example">
hystrix.command.default.execution.isolation.strategy=SEMAPHORE
hystrix.command.default.execution.isolation.semaphore.maxConcurrentRequests=100000
hystrix.command.default.execution.timeout.enabled=false
hystrix.command.default.execution.isolation.thread.timeoutInMilliseconds=20000
</pre>

<table border="1" cellspacing="0" cellpadding="6" rules="all" frame="boader">
<caption class="t-above"><span class="table-number">Table 5:</span> 增加熔断信号量配置</caption>

<colgroup>
<col  class="left" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="left">指标</td>
<td class="right">1并发</td>
<td class="right">2并发</td>
<td class="right">4并发</td>
<td class="right">8并发</td>
<td class="right">16并发</td>
<td class="right">32并发</td>
<td class="right">64 并发</td>
<td class="right">128并发</td>
<td class="right">256并发</td>
</tr>

<tr>
<td class="left">发送总请求数</td>
<td class="right">17057</td>
<td class="right">40571</td>
<td class="right">43521</td>
<td class="right">41810</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
</tr>

<tr>
<td class="left">总时间(s)</td>
<td class="right">100.000</td>
<td class="right">100.002</td>
<td class="right">100.045</td>
<td class="right">100.063</td>
<td class="right">86.713</td>
<td class="right">49.131</td>
<td class="right">43.806</td>
<td class="right">42.358</td>
<td class="right">44.288</td>
</tr>

<tr>
<td class="left">平均请求时间(ms)</td>
<td class="right">5.863</td>
<td class="right">4.930</td>
<td class="right">9.195</td>
<td class="right">19.146</td>
<td class="right">27.748</td>
<td class="right">31.444</td>
<td class="right">56.071</td>
<td class="right">108.437</td>
<td class="right">226.755</td>
</tr>

<tr>
<td class="left">请求时间中位数（50%&lt;)(ms)</td>
<td class="right">5</td>
<td class="right">4</td>
<td class="right">5</td>
<td class="right">6</td>
<td class="right">10</td>
<td class="right">15</td>
<td class="right">21</td>
<td class="right">42</td>
<td class="right">60</td>
</tr>

<tr>
<td class="left">请求时间90%&lt; (ms)</td>
<td class="right">7</td>
<td class="right">5</td>
<td class="right">8</td>
<td class="right">74</td>
<td class="right">79</td>
<td class="right">75</td>
<td class="right">134</td>
<td class="right">295</td>
<td class="right">651</td>
</tr>

<tr>
<td class="left">最大请求时间(ms)</td>
<td class="right">1032</td>
<td class="right">1036</td>
<td class="right">1029</td>
<td class="right">1106</td>
<td class="right">1098</td>
<td class="right">1200</td>
<td class="right">2178</td>
<td class="right">3030</td>
<td class="right">4115</td>
</tr>

<tr>
<td class="left">Error</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
</tr>

<tr>
<td class="left">QPS(请求数/秒)</td>
<td class="right">170.57</td>
<td class="right">405.70</td>
<td class="right">435.01</td>
<td class="right">417.84</td>
<td class="right">576.62</td>
<td class="right">1017.70</td>
<td class="right">1141.41</td>
<td class="right">1180.41</td>
<td class="right">1128.97</td>
</tr>
</tbody>
</table>

<p>
经过网关路由后QPS下降了一半   
</p>
</div>
</div>
<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3">自动注册应用提供hello world服务，oauth认证</h3>
<div class="outline-text-3" id="text-2-3">
<table border="1" cellspacing="0" cellpadding="6" rules="all" frame="boader">
<caption class="t-above"><span class="table-number">Table 6:</span> 通过网关访问自动注册的api key management应用hello world服务, oauth安全认证</caption>

<colgroup>
<col  class="left" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="left">指标</td>
<td class="right">1并发</td>
<td class="right">2并发</td>
<td class="right">4并发</td>
<td class="right">8并发</td>
<td class="right">16并发</td>
<td class="right">32并发</td>
<td class="right">64 并发</td>
<td class="right">128并发</td>
<td class="right">256并发</td>
</tr>

<tr>
<td class="left">发送总请求数</td>
<td class="right">3497</td>
<td class="right">6172</td>
<td class="right">11120</td>
<td class="right">12511</td>
<td class="right">12580</td>
<td class="right">12561</td>
<td class="right">12513</td>
<td class="right">12455</td>
<td class="right">12278</td>
</tr>

<tr>
<td class="left">总时间(s)</td>
<td class="right">100.006</td>
<td class="right">100.022</td>
<td class="right">100.008</td>
<td class="right">100.016</td>
<td class="right">100.000</td>
<td class="right">100.018</td>
<td class="right">100.004</td>
<td class="right">100.007</td>
<td class="right">100.020</td>
</tr>

<tr>
<td class="left">平均请求时间(ms)</td>
<td class="right">28.598</td>
<td class="right">32.412</td>
<td class="right">35.974</td>
<td class="right">63.954</td>
<td class="right">127.186</td>
<td class="right">254.801</td>
<td class="right">511.490</td>
<td class="right">1027.768</td>
<td class="right">2085.444</td>
</tr>

<tr>
<td class="left">请求时间中位数（50%&lt;)(ms)</td>
<td class="right">28</td>
<td class="right">31</td>
<td class="right">34</td>
<td class="right">62</td>
<td class="right">127</td>
<td class="right">258</td>
<td class="right">523</td>
<td class="right">1051</td>
<td class="right">2105</td>
</tr>

<tr>
<td class="left">请求时间90%&lt; (ms)</td>
<td class="right">31</td>
<td class="right">36</td>
<td class="right">44</td>
<td class="right">81</td>
<td class="right">155</td>
<td class="right">307</td>
<td class="right">622</td>
<td class="right">1248</td>
<td class="right">2440</td>
</tr>

<tr>
<td class="left">最大请求时间(ms)</td>
<td class="right">354</td>
<td class="right">1053</td>
<td class="right">1071</td>
<td class="right">1108</td>
<td class="right">1119</td>
<td class="right">1307</td>
<td class="right">1624</td>
<td class="right">2207</td>
<td class="right">3676</td>
</tr>

<tr>
<td class="left">Error</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
</tr>

<tr>
<td class="left">QPS(请求数/秒)</td>
<td class="right">34.97</td>
<td class="right">61.71</td>
<td class="right">111.19</td>
<td class="right">125.09</td>
<td class="right">125.80</td>
<td class="right">125.59</td>
<td class="right">125.12</td>
<td class="right">124.54</td>
<td class="right">122.76</td>
</tr>
</tbody>
</table>

<div class="org-src-container">

<pre class="src src-sh">ab -H <span style="color: #ffa07a;">'authorization: Bearer TGT-117-ei2eTUuee9OndJpbLqowydpby5esHe0qmX7adwDiRQMhCcfusc-cas01.example.org'</span> -t 100 -c 1 http://172.25.17.74:7070/akm-service/apiKey/hw
ab -H <span style="color: #ffa07a;">'authorization: Bearer TGT-117-ei2eTUuee9OndJpbLqowydpby5esHe0qmX7adwDiRQMhCcfusc-cas01.example.org'</span> -t 100 -c 2 http://172.25.17.74:7070/akm-service/apiKey/hw
ab -H <span style="color: #ffa07a;">'authorization: Bearer TGT-117-ei2eTUuee9OndJpbLqowydpby5esHe0qmX7adwDiRQMhCcfusc-cas01.example.org'</span> -t 100 -c 4 http://172.25.17.74:7070/akm-service/apiKey/hw
ab -H <span style="color: #ffa07a;">'authorization: Bearer TGT-117-ei2eTUuee9OndJpbLqowydpby5esHe0qmX7adwDiRQMhCcfusc-cas01.example.org'</span> -t 100 -c 8 http://172.25.17.74:7070/akm-service/apiKey/hw
ab -H <span style="color: #ffa07a;">'authorization: Bearer TGT-117-ei2eTUuee9OndJpbLqowydpby5esHe0qmX7adwDiRQMhCcfusc-cas01.example.org'</span> -t 100 -c 16 http://172.25.17.74:7070/akm-service/apiKey/hw
ab -H <span style="color: #ffa07a;">'authorization: Bearer TGT-117-ei2eTUuee9OndJpbLqowydpby5esHe0qmX7adwDiRQMhCcfusc-cas01.example.org'</span> -t 100 -c 32 http://172.25.17.74:7070/akm-service/apiKey/hw
ab -H <span style="color: #ffa07a;">'authorization: Bearer TGT-117-ei2eTUuee9OndJpbLqowydpby5esHe0qmX7adwDiRQMhCcfusc-cas01.example.org'</span> -t 100 -c 64 http://172.25.17.74:7070/akm-service/apiKey/hw
ab -H <span style="color: #ffa07a;">'authorization: Bearer TGT-117-ei2eTUuee9OndJpbLqowydpby5esHe0qmX7adwDiRQMhCcfusc-cas01.example.org'</span> -t 100 -c 128 http://172.25.17.74:7070/akm-service/apiKey/hw
ab -H <span style="color: #ffa07a;">'authorization: Bearer TGT-117-ei2eTUuee9OndJpbLqowydpby5esHe0qmX7adwDiRQMhCcfusc-cas01.example.org'</span> -t 100 -c 256 http://172.25.17.74:7070/akm-service/apiKey/hw
</pre>
</div>

<table border="1" cellspacing="0" cellpadding="6" rules="all" frame="boader">
<caption class="t-above"><span class="table-number">Table 7:</span> redis中缓存oauth认证结果，有效期为1个小时</caption>

<colgroup>
<col  class="left" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="left">指标</td>
<td class="right">1并发</td>
<td class="right">2并发</td>
<td class="right">4并发</td>
<td class="right">8并发</td>
<td class="right">16并发</td>
<td class="right">32并发</td>
<td class="right">64 并发</td>
<td class="right">128并发</td>
<td class="right">256并发</td>
</tr>

<tr>
<td class="left">发送总请求数</td>
<td class="right">14433</td>
<td class="right">29669</td>
<td class="right">48164</td>
<td class="right">41777</td>
<td class="right">49499</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
</tr>

<tr>
<td class="left">总时间(s)</td>
<td class="right">100.000</td>
<td class="right">100.000</td>
<td class="right">100.043</td>
<td class="right">100.000</td>
<td class="right">100.000</td>
<td class="right">57.528</td>
<td class="right">49.028</td>
<td class="right">45.796</td>
<td class="right">48.216</td>
</tr>

<tr>
<td class="left">平均请求时间(ms)</td>
<td class="right">6.929</td>
<td class="right">6.741</td>
<td class="right">8.309</td>
<td class="right">19.149</td>
<td class="right">32.324</td>
<td class="right">36.818</td>
<td class="right">62.756</td>
<td class="right">117.238</td>
<td class="right">246.865</td>
</tr>

<tr>
<td class="left">请求时间中位数（50%&lt;)(ms)</td>
<td class="right">5</td>
<td class="right">5</td>
<td class="right">6</td>
<td class="right">7</td>
<td class="right">11</td>
<td class="right">19</td>
<td class="right">29</td>
<td class="right">57</td>
<td class="right">164</td>
</tr>

<tr>
<td class="left">请求时间90%&lt; (ms)</td>
<td class="right">6</td>
<td class="right">6</td>
<td class="right">7</td>
<td class="right">66</td>
<td class="right">79</td>
<td class="right">88</td>
<td class="right">144</td>
<td class="right">304</td>
<td class="right">571</td>
</tr>

<tr>
<td class="left">最大请求时间(ms)</td>
<td class="right">1039</td>
<td class="right">1034</td>
<td class="right">1050</td>
<td class="right">1085</td>
<td class="right">3298</td>
<td class="right">1131</td>
<td class="right">1790</td>
<td class="right">1959</td>
<td class="right">3095</td>
</tr>

<tr>
<td class="left">Error</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
</tr>

<tr>
<td class="left">QPS(请求数/秒)</td>
<td class="right">144.33</td>
<td class="right">296.69</td>
<td class="right">481.43</td>
<td class="right">417.77</td>
<td class="right">494.99</td>
<td class="right">869.14</td>
<td class="right">1019.82</td>
<td class="right">1091.79</td>
<td class="right">1037.00</td>
</tr>
</tbody>
</table>

<p>
缓存安全认证结果后QPS相比无安全认证稍微有下降
</p>
</div>
</div>

<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4">数据库精确匹配路由hello world服务, 无auth认证</h3>
<div class="outline-text-3" id="text-2-4">
<table border="1" cellspacing="0" cellpadding="6" rules="all" frame="boader">
<caption class="t-above"><span class="table-number">Table 8:</span> 基于数据库配置路由hello world服务, 无auth认证</caption>

<colgroup>
<col  class="left" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="left">指标</td>
<td class="right">1并发</td>
<td class="right">2并发</td>
<td class="right">4并发</td>
<td class="right">8并发</td>
<td class="right">16并发</td>
<td class="right">32并发</td>
<td class="right">64 并发</td>
<td class="right">128并发</td>
<td class="right">256并发</td>
</tr>

<tr>
<td class="left">发送总请求数</td>
<td class="right">20668</td>
<td class="right">41126</td>
<td class="right">44598</td>
<td class="right">42008</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
</tr>

<tr>
<td class="left">总时间(s)</td>
<td class="right">100.002</td>
<td class="right">100.002</td>
<td class="right">100.002</td>
<td class="right">100.004</td>
<td class="right">90.788</td>
<td class="right">52.921</td>
<td class="right">46.244</td>
<td class="right">45.292</td>
<td class="right">40.550</td>
</tr>

<tr>
<td class="left">平均请求时间(ms)</td>
<td class="right">4.839</td>
<td class="right">4.863</td>
<td class="right">8.969</td>
<td class="right">19.045</td>
<td class="right">29.052</td>
<td class="right">33.870</td>
<td class="right">59.192</td>
<td class="right">115.946</td>
<td class="right">207.616</td>
</tr>

<tr>
<td class="left">请求时间中位数（50%&lt;)(ms)</td>
<td class="right">4</td>
<td class="right">4</td>
<td class="right">5</td>
<td class="right">7</td>
<td class="right">11</td>
<td class="right">18</td>
<td class="right">27</td>
<td class="right">46</td>
<td class="right">100</td>
</tr>

<tr>
<td class="left">请求时间90%&lt; (ms)</td>
<td class="right">5</td>
<td class="right">5</td>
<td class="right">8</td>
<td class="right">70</td>
<td class="right">79</td>
<td class="right">81</td>
<td class="right">141</td>
<td class="right">265</td>
<td class="right">582</td>
</tr>

<tr>
<td class="left">最大请求时间(ms)</td>
<td class="right">1029</td>
<td class="right">1026</td>
<td class="right">1018</td>
<td class="right">1031</td>
<td class="right">1109</td>
<td class="right">1116</td>
<td class="right">2573</td>
<td class="right">4056</td>
<td class="right">3666</td>
</tr>

<tr>
<td class="left">Error</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">2</td>
<td class="right">0</td>
<td class="right">1</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">1</td>
<td class="right">0</td>
</tr>

<tr>
<td class="left">QPS(请求数/秒)</td>
<td class="right">206.67</td>
<td class="right">411.25</td>
<td class="right">445.97</td>
<td class="right">420.06</td>
<td class="right">550.73</td>
<td class="right">944.80</td>
<td class="right">1081.23</td>
<td class="right">1103.96</td>
<td class="right">1233.05</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5">数据库精确匹配路由hello world服务, 缓存Oauth认证结果</h3>
<div class="outline-text-3" id="text-2-5">
<table border="1" cellspacing="0" cellpadding="6" rules="all" frame="boader">
<caption class="t-above"><span class="table-number">Table 9:</span> 基于数据库配置路由hello world服务, 缓存Oauth认证结果</caption>

<colgroup>
<col  class="left" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="left">指标</td>
<td class="right">1并发</td>
<td class="right">2并发</td>
<td class="right">4并发</td>
<td class="right">8并发</td>
<td class="right">16并发</td>
<td class="right">32并发</td>
<td class="right">64 并发</td>
<td class="right">128并发</td>
<td class="right">256并发</td>
</tr>

<tr>
<td class="left">发送总请求数</td>
<td class="right">17553</td>
<td class="right">34038</td>
<td class="right">45800</td>
<td class="right">42053</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
</tr>

<tr>
<td class="left">总时间(s)</td>
<td class="right">100.000</td>
<td class="right">100.002</td>
<td class="right">100.001</td>
<td class="right">100.006</td>
<td class="right">97.159</td>
<td class="right">57.970</td>
<td class="right">47.910</td>
<td class="right">42.522</td>
<td class="right">39.128</td>
</tr>

<tr>
<td class="left">平均请求时间(ms)</td>
<td class="right">5.697</td>
<td class="right">5.876</td>
<td class="right">8.734</td>
<td class="right">19.025</td>
<td class="right">31.091</td>
<td class="right">37.101</td>
<td class="right">61.325</td>
<td class="right">108.857</td>
<td class="right">200.337</td>
</tr>

<tr>
<td class="left">请求时间中位数（50%&lt;)(ms)</td>
<td class="right">5</td>
<td class="right">5</td>
<td class="right">6</td>
<td class="right">8</td>
<td class="right">13</td>
<td class="right">21</td>
<td class="right">33</td>
<td class="right">56</td>
<td class="right">126</td>
</tr>

<tr>
<td class="left">请求时间90%&lt; (ms)</td>
<td class="right">6</td>
<td class="right">6</td>
<td class="right">9</td>
<td class="right">67</td>
<td class="right">79</td>
<td class="right">83</td>
<td class="right">141</td>
<td class="right">262</td>
<td class="right">488</td>
</tr>

<tr>
<td class="left">最大请求时间(ms)</td>
<td class="right">1013</td>
<td class="right">1033</td>
<td class="right">214</td>
<td class="right">1031</td>
<td class="right">1060</td>
<td class="right">1064</td>
<td class="right">1921</td>
<td class="right">1683</td>
<td class="right">2851</td>
</tr>

<tr>
<td class="left">Error</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">3</td>
<td class="right">2</td>
</tr>

<tr>
<td class="left">QPS(请求数/秒)</td>
<td class="right">175.53</td>
<td class="right">340.37</td>
<td class="right">458.00</td>
<td class="right">420.50</td>
<td class="right">514.62</td>
<td class="right">862.52</td>
<td class="right">1043.62</td>
<td class="right">1175.85</td>
<td class="right">1277.85</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-2-6" class="outline-3">
<h3 id="sec-2-6">数据库模糊路径匹配路由hello world服务, 无安全认证</h3>
<div class="outline-text-3" id="text-2-6">
<table border="1" cellspacing="0" cellpadding="6" rules="all" frame="boader">
<caption class="t-above"><span class="table-number">Table 10:</span> 数据库路径模糊匹配hello world服务, 无安全认证</caption>

<colgroup>
<col  class="left" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="left">指标</td>
<td class="right">1并发</td>
<td class="right">2并发</td>
<td class="right">4并发</td>
<td class="right">8并发</td>
<td class="right">16并发</td>
<td class="right">32并发</td>
<td class="right">64 并发</td>
<td class="right">128并发</td>
<td class="right">256并发</td>
</tr>

<tr>
<td class="left">发送总请求数</td>
<td class="right">19159</td>
<td class="right">36485</td>
<td class="right">46210</td>
<td class="right">42780</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
</tr>

<tr>
<td class="left">总时间(s)</td>
<td class="right">100.000</td>
<td class="right">100.001</td>
<td class="right">100.882</td>
<td class="right">100.028</td>
<td class="right">91.421</td>
<td class="right">53.711</td>
<td class="right">44.517</td>
<td class="right">38.727</td>
<td class="right">46.637</td>
</tr>

<tr>
<td class="left">平均请求时间(ms)</td>
<td class="right">5.219</td>
<td class="right">5.482</td>
<td class="right">8.732</td>
<td class="right">18.706</td>
<td class="right">29.255</td>
<td class="right">34.375</td>
<td class="right">56.982</td>
<td class="right">99.140</td>
<td class="right">238.783</td>
</tr>

<tr>
<td class="left">请求时间中位数（50%&lt;)(ms)</td>
<td class="right">5</td>
<td class="right">5</td>
<td class="right">5</td>
<td class="right">7</td>
<td class="right">12</td>
<td class="right">17</td>
<td class="right">26</td>
<td class="right">51</td>
<td class="right">81</td>
</tr>

<tr>
<td class="left">请求时间90%&lt; (ms)</td>
<td class="right">6</td>
<td class="right">6</td>
<td class="right">8</td>
<td class="right">69</td>
<td class="right">78</td>
<td class="right">80</td>
<td class="right">129</td>
<td class="right">241</td>
<td class="right">538</td>
</tr>

<tr>
<td class="left">最大请求时间(ms)</td>
<td class="right">1029</td>
<td class="right">1036</td>
<td class="right">1059</td>
<td class="right">1035</td>
<td class="right">1185</td>
<td class="right">1125</td>
<td class="right">3189</td>
<td class="right">1670</td>
<td class="right">5218</td>
</tr>

<tr>
<td class="left">Error</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">2</td>
</tr>

<tr>
<td class="left">QPS(请求数/秒)</td>
<td class="right">191.59</td>
<td class="right">364.85</td>
<td class="right">458.06</td>
<td class="right">427.68</td>
<td class="right">546.92</td>
<td class="right">930.91</td>
<td class="right">1123.17</td>
<td class="right">1291.10</td>
<td class="right">1072.10</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-2-7" class="outline-3">
<h3 id="sec-2-7">数据库模糊路径匹配路由hello world服务, 缓存Oauth认证结果</h3>
<div class="outline-text-3" id="text-2-7">
<table border="1" cellspacing="0" cellpadding="6" rules="all" frame="boader">
<caption class="t-above"><span class="table-number">Table 11:</span> 数据库路径模糊匹配hello world服务, 缓存Oauth认证结果</caption>

<colgroup>
<col  class="left" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="left">指标</td>
<td class="right">1并发</td>
<td class="right">2并发</td>
<td class="right">4并发</td>
<td class="right">8并发</td>
<td class="right">16并发</td>
<td class="right">32并发</td>
<td class="right">64 并发</td>
<td class="right">128并发</td>
<td class="right">256并发</td>
</tr>

<tr>
<td class="left">发送总请求数</td>
<td class="right">16424</td>
<td class="right">32172</td>
<td class="right">46472</td>
<td class="right">42636</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
</tr>

<tr>
<td class="left">总时间(s)</td>
<td class="right">100.001</td>
<td class="right">100.004</td>
<td class="right">100.000</td>
<td class="right">100.026</td>
<td class="right">97.788</td>
<td class="right">61.316</td>
<td class="right">48.973</td>
<td class="right">42.492</td>
<td class="right">40.519</td>
</tr>

<tr>
<td class="left">平均请求时间(ms)</td>
<td class="right">6.089</td>
<td class="right">6.217</td>
<td class="right">8.607</td>
<td class="right">18.768</td>
<td class="right">31.292</td>
<td class="right">39.242</td>
<td class="right">62.685</td>
<td class="right">108.780</td>
<td class="right">207.459</td>
</tr>

<tr>
<td class="left">请求时间中位数（50%&lt;)(ms)</td>
<td class="right">6</td>
<td class="right">6</td>
<td class="right">6</td>
<td class="right">8</td>
<td class="right">13</td>
<td class="right">22</td>
<td class="right">34</td>
<td class="right">60</td>
<td class="right">126</td>
</tr>

<tr>
<td class="left">请求时间90%&lt; (ms)</td>
<td class="right">6</td>
<td class="right">7</td>
<td class="right">8</td>
<td class="right">65</td>
<td class="right">79</td>
<td class="right">87</td>
<td class="right">141</td>
<td class="right">256</td>
<td class="right">500</td>
</tr>

<tr>
<td class="left">最大请求时间(ms)</td>
<td class="right">1022</td>
<td class="right">1034</td>
<td class="right">1037</td>
<td class="right">1041</td>
<td class="right">1034</td>
<td class="right">1452</td>
<td class="right">2420</td>
<td class="right">1325</td>
<td class="right">3832</td>
</tr>

<tr>
<td class="left">Error</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">1</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">2</td>
</tr>

<tr>
<td class="left">QPS(请求数/秒)</td>
<td class="right">164.24</td>
<td class="right">321.71</td>
<td class="right">464.72</td>
<td class="right">426.25</td>
<td class="right">511.31</td>
<td class="right">815.45</td>
<td class="right">1020.98</td>
<td class="right">1176.69</td>
<td class="right">1233.98</td>
</tr>
</tbody>
</table>

<p>
基于数据库配置的路由和自动注册的应用QPS差不多
</p>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">业务应用测试</h2>
<div class="outline-text-2" id="text-3">
<p>
每次API调用返回数据量7936 bytes 
</p>
</div>
<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1">直接调用后台/portal/products</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">

<pre class="src src-sh">ab -t 100 -c 20 http://172.25.12.81:6000/portal/products
ab -t 100 -c 50 http://172.25.12.81:6000/portal/products
ab -t 100 -c 100 http://172.25.12.81:6000/portal/products
ab -t 100 -c 200 http://172.25.12.81:6000/portal/products
ab -t 100 -c 300 http://172.25.12.81:6000/portal/products
ab -t 100 -c 500 http://172.25.12.81:6000/portal/products
ab -t 100 -c 1000 http://172.25.12.81:6000/portal/products
</pre>
</div>

<table border="1" cellspacing="0" cellpadding="6" rules="all" frame="boader">
<caption class="t-above"><span class="table-number">Table 12:</span> 直接调用后台/portal/products</caption>

<colgroup>
<col  class="left" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="left">指标</td>
<td class="right">20 并发</td>
<td class="right">50并发</td>
<td class="right">100 并发</td>
<td class="right">200 并发</td>
<td class="right">300并发</td>
<td class="right">500并发</td>
<td class="right">1000并发</td>
</tr>

<tr>
<td class="left">发送总请求数</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
<td class="right">50000</td>
</tr>

<tr>
<td class="left">总时间(s)</td>
<td class="right">78.843</td>
<td class="right">71.038</td>
<td class="right">60.544</td>
<td class="right">53.550</td>
<td class="right">45.478</td>
<td class="right">43.113</td>
<td class="right">38.173</td>
</tr>

<tr>
<td class="left">平均请求时间(ms)</td>
<td class="right">31.537</td>
<td class="right">71.038</td>
<td class="right">121.087</td>
<td class="right">214.200</td>
<td class="right">272.871</td>
<td class="right">431.132</td>
<td class="right">763.462</td>
</tr>

<tr>
<td class="left">请求时间中位数（50%&lt;)(ms)</td>
<td class="right">28</td>
<td class="right">66</td>
<td class="right">121</td>
<td class="right">232</td>
<td class="right">283</td>
<td class="right">464</td>
<td class="right">851</td>
</tr>

<tr>
<td class="left">请求时间90%&lt; (ms)</td>
<td class="right">50</td>
<td class="right">112</td>
<td class="right">199</td>
<td class="right">351</td>
<td class="right">440</td>
<td class="right">700</td>
<td class="right">1220</td>
</tr>

<tr>
<td class="left">最大请求时间(ms)</td>
<td class="right">1065</td>
<td class="right">1137</td>
<td class="right">1123</td>
<td class="right">1373</td>
<td class="right">1720</td>
<td class="right">4223</td>
<td class="right">4593</td>
</tr>

<tr>
<td class="left">Error</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
</tr>

<tr>
<td class="left">QPS(请求数/秒)</td>
<td class="right">634.17</td>
<td class="right">703.85</td>
<td class="right">825.85</td>
<td class="right">933.71</td>
<td class="right">1099.42</td>
<td class="right">1159.74</td>
<td class="right">1309.82</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2">网关优化前调用/portal/products</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">

<pre class="src src-sh">ab -t 100 -c 20 -H <span style="color: #ffa07a;">"Authorization: Bearer TGT-156-g7eqzcM5fY167ueeyCuJGSRljrEslehswfY52rjlwX2yQErrx4-cas01.example.org"</span> http://172.25.12.81:7070/portal/products
ab -t 100 -c 50  -H <span style="color: #ffa07a;">"Authorization: Bearer TGT-156-g7eqzcM5fY167ueeyCuJGSRljrEslehswfY52rjlwX2yQErrx4-cas01.example.org"</span> http://172.25.12.81:7070/portal/products
ab -t 100 -c 100  -H <span style="color: #ffa07a;">"Authorization: Bearer TGT-156-g7eqzcM5fY167ueeyCuJGSRljrEslehswfY52rjlwX2yQErrx4-cas01.example.org"</span> http://172.25.12.81:7070/portal/products
ab -t 100 -c 200  -H <span style="color: #ffa07a;">"Authorization: Bearer TGT-156-g7eqzcM5fY167ueeyCuJGSRljrEslehswfY52rjlwX2yQErrx4-cas01.example.org"</span> http://172.25.12.81:7070/portal/products
</pre>
</div>

<table border="1" cellspacing="0" cellpadding="6" rules="all" frame="boader">
<caption class="t-above"><span class="table-number">Table 13:</span> 81环境网关路由后台/portal/products</caption>

<colgroup>
<col  class="left" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="left">指标</td>
<td class="right">20 并发</td>
<td class="right">50并发</td>
<td class="right">100 并发</td>
<td class="right">200 并发</td>
</tr>

<tr>
<td class="left">发送总请求数</td>
<td class="right">7805</td>
<td class="right">8087</td>
<td class="right">8001</td>
<td class="right">8069</td>
</tr>

<tr>
<td class="left">总时间(s)</td>
<td class="right">100.010</td>
<td class="right">100.041</td>
<td class="right">100.018</td>
<td class="right">100.098</td>
</tr>

<tr>
<td class="left">平均请求时间(ms)</td>
<td class="right">256.273</td>
<td class="right">618.529</td>
<td class="right">1250.069</td>
<td class="right">2481.047</td>
</tr>

<tr>
<td class="left">请求时间中位数（50%&lt;)(ms)</td>
<td class="right">243</td>
<td class="right">596</td>
<td class="right">1211</td>
<td class="right">2400</td>
</tr>

<tr>
<td class="left">请求时间90%&lt; (ms)</td>
<td class="right">371</td>
<td class="right">1029</td>
<td class="right">1897</td>
<td class="right">3807</td>
</tr>

<tr>
<td class="left">最大请求时间(ms)</td>
<td class="right">915</td>
<td class="right">1704</td>
<td class="right">3908</td>
<td class="right">6246</td>
</tr>

<tr>
<td class="left">Error</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
</tr>

<tr>
<td class="left">QPS(请求数/秒)</td>
<td class="right">78.04</td>
<td class="right">80.84</td>
<td class="right">80.00</td>
<td class="right">80.61</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3">网关优化后调用/portal/products</h3>
<div class="outline-text-3" id="text-3-3">
<div class="org-src-container">

<pre class="src src-sh">ab -t 100 -c 20 -H <span style="color: #ffa07a;">"Authorization: Bearer TGT-156-g7eqzcM5fY167ueeyCuJGSRljrEslehswfY52rjlwX2yQErrx4-cas01.example.org"</span> http://172.25.17.74:7070/portal/products
ab -t 100 -c 50  -H <span style="color: #ffa07a;">"Authorization: Bearer TGT-156-g7eqzcM5fY167ueeyCuJGSRljrEslehswfY52rjlwX2yQErrx4-cas01.example.org"</span> http://172.25.17.74:7070/portal/products
ab -t 100 -c 100  -H <span style="color: #ffa07a;">"Authorization: Bearer TGT-156-g7eqzcM5fY167ueeyCuJGSRljrEslehswfY52rjlwX2yQErrx4-cas01.example.org"</span> http://172.25.17.74:7070/portal/products
ab -t 100 -c 200  -H <span style="color: #ffa07a;">"Authorization: Bearer TGT-156-g7eqzcM5fY167ueeyCuJGSRljrEslehswfY52rjlwX2yQErrx4-cas01.example.org"</span> http://172.25.17.74:7070/portal/products
</pre>
</div>

<table border="1" cellspacing="0" cellpadding="6" rules="all" frame="boader">
<caption class="t-above"><span class="table-number">Table 14:</span> 74环境网关路由后台/portal/products</caption>

<colgroup>
<col  class="left" />

<col  class="right" />

<col  class="right" />

<col  class="right" />

<col  class="right" />
</colgroup>
<tbody>
<tr>
<td class="left">指标</td>
<td class="right">20 并发</td>
<td class="right">50并发</td>
<td class="right">100 并发</td>
<td class="right">200 并发</td>
</tr>

<tr>
<td class="left">发送总请求数</td>
<td class="right">36489</td>
<td class="right">38518</td>
<td class="right">41546</td>
<td class="right">43017</td>
</tr>

<tr>
<td class="left">总时间(s)</td>
<td class="right">100.002</td>
<td class="right">100.000</td>
<td class="right">100.002</td>
<td class="right">100.011</td>
</tr>

<tr>
<td class="left">平均请求时间(ms)</td>
<td class="right">54.812</td>
<td class="right">129.810</td>
<td class="right">240.701</td>
<td class="right">464.982</td>
</tr>

<tr>
<td class="left">请求时间中位数（50%&lt;)(ms)</td>
<td class="right">49</td>
<td class="right">122</td>
<td class="right">246</td>
<td class="right">516</td>
</tr>

<tr>
<td class="left">请求时间90%&lt; (ms)</td>
<td class="right">84</td>
<td class="right">194</td>
<td class="right">356</td>
<td class="right">674</td>
</tr>

<tr>
<td class="left">最大请求时间(ms)</td>
<td class="right">1128</td>
<td class="right">1302</td>
<td class="right">1419</td>
<td class="right">2050</td>
</tr>

<tr>
<td class="left">Error</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
</tr>

<tr>
<td class="left">QPS(请求数/秒)</td>
<td class="right">364.88</td>
<td class="right">385.18</td>
<td class="right">415.45</td>
<td class="right">430.12</td>
</tr>
</tbody>
</table>

<p>
与直接调用相比QPS下降了一半，并发越高，下降越明显，网关超过100后QPS提高不大
</p>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">单节点测试总结</h2>
<div class="outline-text-2" id="text-4">
<ul class="org-ul">
<li>spring boot应用并发超过100以后，QPS基本不会提高，等待时间成比例增长，启动线程的开销，以及线程上下文切换的耗时，开辟线程带来的内存损耗都会影响性能，相比较而言go程序的性能非常好，基本上能支持到上千个并发
</li>
<li>在频繁调用的代码中，写日志文件会大大降低并发性能
</li>
<li>调用安全认证模块，急剧降低并发性能
</li>
<li>经过网关QPS会下降一半以上，随着并发量上升，性能下降越明显
</li>
</ul>

<p>
<a href="cluster_test.html">Next：集群群环境测试结果</a>
</p>

<p>
<a href="zuul_test.html">Home：目录</a>
</p>
</div>
</div>
</div>
<div id="postamble" class="status">

		  <br/>
		  <div class='ds-thread'></div>
		  <script>
		  var duoshuoQuery = {short_name:'klose911'};
		  (function() {
					  var dsThread = document.getElementsByClassName('ds-thread')[0];
					  dsThread.setAttribute('data-thread-key', document.title);
					  dsThread.setAttribute('data-title', document.title);
					  dsThread.setAttribute('data-url', window.location.href);
					  var ds = document.createElement('script');
					  ds.type = 'text/javascript';ds.async = true;
					  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
					  ds.charset = 'UTF-8';
					  (document.getElementsByTagName('head')[0] 
						|| document.getElementsByTagName('body')[0]).appendChild(ds);
					  })();
		  </script>
		  <script>
		  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
		  ga('create', 'UA-90850421-1', 'auto');
		  ga('send', 'pageview');
		  </script>
</div>
</body>
</html>
