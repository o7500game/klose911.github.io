<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>逻辑求值器</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Wu, Shanliang" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="css/main.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">逻辑求值器</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org612035b">逻辑式程序设计</a>
<ul>
<li><a href="#org830a03e">演绎信息检索</a>
<ul>
<li><a href="#orgb3413b5">简单数据库</a></li>
<li><a href="#org4aeffba">简单查询</a>
<ul>
<li><a href="#org11b98ee">总结</a></li>
</ul>
</li>
<li><a href="#org2028587">复合查询</a>
<ul>
<li><a href="#org2c6289d">and 查询</a></li>
<li><a href="#org925c879">or 查询</a></li>
<li><a href="#org8fe2639">not 查询</a></li>
<li><a href="#orge2d4b18">lisp-value</a></li>
</ul>
</li>
<li><a href="#org3723c4c">规则</a></li>
<li><a href="#org15196b6">逻辑程序</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orga080a14">实现</a></li>
</ul>
</div>
</div>
<p>
<b>数学</b> 处理 <span class="underline">说明式</span> 知识， <b>计算机</b> 科学处理 <span class="underline">命令式</span> 知识：
</p>
<ul class="org-ul">
<li>程序语言要求用 <span class="underline">算法的方式</span> 描述解决问题过程</li>
<li>实际上程序语言也常提供一些 <span class="underline">说明性描述</span> 方式：
<ul class="org-ul">
<li>用户可以省去计算过程的很多细节描述，例如输出函数的格式描述</li>
</ul></li>
</ul>

<pre class="example">
  多数程序语言要求用定义数学函数的方式组织程序：

  程序描述的是“怎么做”
  所描述的计算有明确方向，从输入到输出
  描述函数关系的表达式，也给出了计算出结果的方法
  定义的过程完成从参数到结果的计算
</pre>

<p>
同样也有些例外。比如：
</p>
<ul class="org-ul">
<li><span class="underline">约束传递</span> 系统中的计算对象是约束关系，没有明确的计算方向和顺序，其基础系统要做很多工作来支持计算</li>
<li><span class="underline">非确定性</span> 程序求值器里的表达式可有多个值，求值器设法根据表达式描述的关系找出满足要求的</li>
</ul>

<div id="outline-container-org612035b" class="outline-2">
<h2 id="org612035b">逻辑式程序设计</h2>
<div class="outline-text-2" id="text-org612035b">
<p>
<b>逻辑程序设计</b> 可看作上面想法的一种推广，它基于 <span class="underline">关系模型</span> 和称为 <span class="underline">合一</span> 的重要操作，其编程就是用 <b>逻辑公式描述事物之间的约束关系</b> （属于“是什么”的范畴），支持 <b>多重结果和无确定方向</b> 的计算
</p>

<pre class="example">
    逻辑程序设计特别适合一些应用领域的需要

    如数据库查询语言 Datalog ，支持查询基于已有事实的隐含事实
</pre>

<p>
一个“是什么”的描述可能蕴涵许多“怎样做”的过程，比如：
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #daa520; font-weight: bold;">append</span> x y<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">if</span> <span style="color: #696969;">(</span>null? x<span style="color: #696969;">)</span>
      y
      <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>car x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>append <span style="color: #696969;">(</span>cdr x<span style="color: #696969;">)</span> y<span style="color: #696969;">))))</span>
</pre>
</div>

<p>
可以认为，这个程序表达的是两条规则：
</p>
<ol class="org-ol">
<li>对任何一个表 y，空表与其拼接得到的表就是 y 本身</li>
<li>对任何表 u, v, y, z： <span class="underline">(cons u v)</span>  与 <span class="underline">y</span> 拼接得到 <span class="underline">(cons u z)</span> 的条件是 <b>v 与 y  的 <span class="underline">append</span>  是 z</b></li>
</ol>



<ul class="org-ul">
<li>append <span class="underline">过程</span> 定义和两条 <span class="underline">规则</span> 都可以回答下面问题：
<ul class="org-ul">
<li>找出 (a b) 和 (c d) 的 append</li>
</ul></li>
<li>然而这两条 <b>规则</b> 还可以回答下面问题（但 append  <span class="underline">过程</span> 不行）：
<ul class="org-ul">
<li>找出一个表 y 使 (a b) 与它的拼接能得到 (a b c d)</li>
<li>找出所有拼接起来能得到 (a b c d) 的表 x 和 y</li>
</ul></li>
</ul>

<p>
在逻辑式程序语言里，可以写出与上面两条规则直接对应的表达式，求值器可以基于它得到上述几个问题的解
</p>

<pre class="example">
    各种逻辑语言（包括下面介绍的）都有缺陷，简单提供“做什么”知识

    有时会使求值器陷入无穷循环或产生非用户希望的行为
</pre>
</div>

<div id="outline-container-org830a03e" class="outline-3">
<h3 id="org830a03e">演绎信息检索</h3>
<div class="outline-text-3" id="text-org830a03e">
<p>
逻辑式编程语言特别适合用作 <span class="underline">数据库接口</span> ，完成 <b>复杂的信息检索</b> 。 <span class="underline">查询语言</span> 就是为此设计的，先用一个实例展示逻辑式编程的使用：
</p>
</div>

<div id="outline-container-orgb3413b5" class="outline-4">
<h4 id="orgb3413b5">简单数据库</h4>
<div class="outline-text-4" id="text-orgb3413b5">
<p>
设 Microshaft 公司（位于波士顿的高科技公司）需要人事数据库，逻辑式语言不仅能做数据导向的信息访问，还能基于已有数据做推理
</p>

<p>
数据库内容是有关公司人事的断言，有许多描述各种事实的断言。Ben 是公司的计算机专家，关于他的断言如下：
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span>address <span style="color: #696969;">(</span>Bitdiddle Ben<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>Slumerville <span style="color: #696969;">(</span>Ridge Road<span style="color: #696969;">)</span> 10<span style="color: #696969;">))</span>

<span style="color: #696969;">(</span>job <span style="color: #696969;">(</span>Bitdiddle Ben<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>computer wizard<span style="color: #696969;">))</span>

<span style="color: #696969;">(</span>salary <span style="color: #696969;">(</span>Bitdiddle Ben<span style="color: #696969;">)</span> 60000<span style="color: #696969;">)</span>
</pre>
</div>

<ul class="org-ul">
<li>在形式上，每个断言是一个表，其元素还可以是表</li>
<li>一个断言描述一个客观事实</li>
</ul>

<p>
Ben 管理公司的计算机分部，管理两个程序员和一个计算机技师：
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span>address <span style="color: #696969;">(</span>Hacker Alyssa P<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>Cambridge <span style="color: #696969;">(</span>Mass Ave<span style="color: #696969;">)</span> 78<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span>job <span style="color: #696969;">(</span>Hacker Alyssa P<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>computer programmer<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span>salary <span style="color: #696969;">(</span>Hacker Alyssa P<span style="color: #696969;">)</span> 40000<span style="color: #696969;">)</span>
<span style="color: #696969;">(</span>supervisor <span style="color: #696969;">(</span>Hacker Alyssa P<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>Bitdiddle Ben<span style="color: #696969;">))</span>

<span style="color: #696969;">(</span>address <span style="color: #696969;">(</span>Fect Cy D<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>Cambridge <span style="color: #696969;">(</span>Ames Street<span style="color: #696969;">)</span> 3<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span>job <span style="color: #696969;">(</span>Fect Cy D<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>computer programmer<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span>salary <span style="color: #696969;">(</span>Fect Cy D<span style="color: #696969;">)</span> 35000<span style="color: #696969;">)</span>
<span style="color: #696969;">(</span>supervisor <span style="color: #696969;">(</span>Fect Cy D<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>Bitdiddle Ben<span style="color: #696969;">))</span>

<span style="color: #696969;">(</span>address <span style="color: #696969;">(</span>Tweakit Lem E<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>Boston <span style="color: #696969;">(</span>Bay State Road<span style="color: #696969;">)</span> 22<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span>job <span style="color: #696969;">(</span>Tweakit Lem E<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>computer technician<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span>salary <span style="color: #696969;">(</span>Tweakit Lem E<span style="color: #696969;">)</span> 25000<span style="color: #696969;">)</span>
<span style="color: #696969;">(</span>supervisor <span style="color: #696969;">(</span>Tweakit Lem E<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>Bitdiddle Ben<span style="color: #696969;">))</span>
</pre>
</div>

<p>
Hacker Alyssa 管着一个实习程序员：
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span>address <span style="color: #696969;">(</span>Reasoner Louis<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>Slumerville <span style="color: #696969;">(</span>Pine Tree Road<span style="color: #696969;">)</span> 80<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span>job <span style="color: #696969;">(</span>Reasoner Louis<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>computer programmer trainee<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span>salary <span style="color: #696969;">(</span>Reasoner Louis<span style="color: #696969;">)</span> 30000<span style="color: #696969;">)</span>
<span style="color: #696969;">(</span>supervisor <span style="color: #696969;">(</span>Reasoner Louis<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>Hacker Alyssa P<span style="color: #696969;">))</span>
</pre>
</div>

<pre class="example">
      计算机分部所有人员的职务的第一个符号都是 computer
</pre>

<p>
Ben 是公司的高级雇员，其上司是公司大老板 Oliver：
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span>supervisor <span style="color: #696969;">(</span>Bitdiddle Ben<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>Warbucks Oliver<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span>address <span style="color: #696969;">(</span>Warbucks Oliver<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>Swellesley <span style="color: #696969;">(</span>Top Heap Road<span style="color: #696969;">)))</span>
<span style="color: #696969;">(</span>job <span style="color: #696969;">(</span>Warbucks Oliver<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>administration big wheel<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span>salary <span style="color: #696969;">(</span>Warbucks Oliver<span style="color: #696969;">)</span> 150000<span style="color: #696969;">)</span>
</pre>
</div>

<p>
公司有一个财务分部，人员包括一个主管会计和一个助手：
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span>address <span style="color: #696969;">(</span>Scrooge Eben<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>Weston <span style="color: #696969;">(</span>Shady Lane<span style="color: #696969;">)</span> 10<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span>job <span style="color: #696969;">(</span>Scrooge Eben<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>accounting chief accountant<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span>salary <span style="color: #696969;">(</span>Scrooge Eben<span style="color: #696969;">)</span> 75000<span style="color: #696969;">)</span>
<span style="color: #696969;">(</span>supervisor <span style="color: #696969;">(</span>Scrooge Eben<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>Warbucks Oliver<span style="color: #696969;">))</span>

<span style="color: #696969;">(</span>address <span style="color: #696969;">(</span>Cratchet Robert<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>Allston <span style="color: #696969;">(</span>N Harvard Street<span style="color: #696969;">)</span> 16<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span>job <span style="color: #696969;">(</span>Cratchet Robert<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>accounting scrivener<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span>salary <span style="color: #696969;">(</span>Cratchet Robert<span style="color: #696969;">)</span> 18000<span style="color: #696969;">)</span>
<span style="color: #696969;">(</span>supervisor <span style="color: #696969;">(</span>Cratchet Robert<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>Scrooge Eben<span style="color: #696969;">))</span>
</pre>
</div>

<p>
老板有一个秘书：
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span>address <span style="color: #696969;">(</span>Aull DeWitt<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>Slumerville <span style="color: #696969;">(</span>Onion Square<span style="color: #696969;">)</span> 5<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span>job <span style="color: #696969;">(</span>Aull DeWitt<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>administration secretary<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span>salary <span style="color: #696969;">(</span>Aull DeWitt<span style="color: #696969;">)</span> 25000<span style="color: #696969;">)</span>
<span style="color: #696969;">(</span>supervisor <span style="color: #696969;">(</span>Aull DeWitt<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>Warbucks Oliver<span style="color: #696969;">))</span>
</pre>
</div>

<p>
还有一些断言说明各种人能从事的工作之间的关系：
</p>
<ul class="org-ul">
<li>计算机专家可以做程序员和技师的工作：</li>
</ul>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span>can-do-job <span style="color: #696969;">(</span>computer wizard<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>computer programmer<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span>can-do-job <span style="color: #696969;">(</span>computer wizard<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>computer technician<span style="color: #696969;">))</span>
</pre>
</div>
<ul class="org-ul">
<li>程序员可以做实习程序员的工作：</li>
</ul>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span>can-do-job <span style="color: #696969;">(</span>computer programmer<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span>computer programmer trainee<span style="color: #696969;">))</span>
</pre>
</div>
<ul class="org-ul">
<li>秘书可以做老板的工作：</li>
</ul>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span>can-do-job <span style="color: #696969;">(</span>administration secretary<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span>administration big wheel<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4aeffba" class="outline-4">
<h4 id="org4aeffba">简单查询</h4>
<div class="outline-text-4" id="text-org4aeffba">
<p>
要查询数据库里的信息，只需在提示符下输入查询。如：
</p>
<pre class="example">
;;; Query input:
(job ?x (computer programmer))

;;; Query results:
(job (Hacker Alyssa P) (computer programmer))
(job (Fect Cy D) (computer programmer))
</pre>

<ul class="org-ul">
<li>查询语句描述要 <b>查询信息的模式</b> ，其中有些项是 <span class="underline">具体信息</span> ： 
<ul class="org-ul">
<li><span class="underline">问号开头的模式变量</span> 项（上面 ?x ）可与任何东西匹配</li>
</ul></li>
<li>系统响应查询时，给出 <b>数据库里与查询模式 <span class="underline">匹配的所有</span> 条目</b></li>

<li>需要区分 <span class="underline">多个匹配</span> 和 <span class="underline">同一匹配的多次</span> 出现，因此 <b>模式变量需要名字</b> ：</li>
</ul>
<pre class="example">
(address ?x ?y) : 系统列出所有雇员的地址条目
</pre>

<ul class="org-ul">
<li>如果查询中没有变量，就相当于问相应事实是否存在</li>
<li>同一模式变量可在一个查询里出现多次，表示需要 <span class="underline">同一匹配</span> ：</li>
</ul>
<pre class="example">
(supervisor ?x ?x) ：要求给出所有自己管自己的雇员的条目
</pre>

<p>
列出所有从事计算机工作的雇员：
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span>job ?x <span style="color: #696969;">(</span>computer ?type<span style="color: #696969;">))</span>
</pre>
</div>

<p>
系统响应是：
</p>
<pre class="example">
(job (Bitdiddle Ben) (computer wizard))
(job (Hacker Alyssa P) (computer programmer))
(job (Fect Cy D) (computer programmer))
(job (Tweakit Lem E) (computer technician))
</pre>

<p>
由于 <span class="underline">?type</span> 只能匹配一个项，他不匹配：
</p>
<pre class="example">
(job (Reasoner Louis) (computer programmer trainee))
</pre>

<p>
如果希望匹配第一个元素是 <span class="underline">computer</span>  的 <b>所有条目</b> ，应写：
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span>job ?x <span style="color: #696969;">(</span>computer . ?type<span style="color: #696969;">))</span>
</pre>
</div>

<p>
<b>(computer . ?type)</b> 能匹配 <span class="underline">(computer programmer trainee)</span> ，也能匹配 <span class="underline">(computer technician)</span> 和 <span class="underline">(computer)</span>  
</p>
</div>

<div id="outline-container-org11b98ee" class="outline-5">
<h5 id="org11b98ee">总结</h5>
<div class="outline-text-5" id="text-org11b98ee">
<ul class="org-ul">
<li>设法找出使查询语句中的模式变量满足查询模式的所有赋值，即找出这些变量的所有可能指派（具体表达式），使得把模式中的变量代换为具体表达式后得到的条目在数据库里</li>
<li>对查询的响应是列出数据库里所有满足模式的条目，用找到的所有可能赋值对查询模式实例化，显示得到的结果</li>
<li>如果查询模式里无变量，就简化为对该查询是否出现在数据库里的检验。相应的赋值是空赋值</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org2028587" class="outline-4">
<h4 id="org2028587">复合查询</h4>
<div class="outline-text-4" id="text-org2028587">
<p>
简单查询是基本操作，可以在其基础上构造 <b>复合查询</b> 。查询语言的组合手段是连接词 <span class="underline">and</span> ,  <span class="underline">or</span> 和 <span class="underline">not</span> 
</p>
<pre class="example">
    注意：这些组合手段不是 Scheme 内部操作
</pre>
<p>
对复合查询，系统也是 <b>设法找出所有能满足它的赋值</b> ，并显示用这些赋值实例化查询模式得到的结果
</p>
</div>

<div id="outline-container-org2c6289d" class="outline-5">
<h5 id="org2c6289d">and 查询</h5>
<div class="outline-text-5" id="text-org2c6289d">
<p>
and 复合的一般形式：
</p>

<pre class="example">
(and &lt;query1&gt;&lt;query2&gt; ... &lt;queryn&gt;)
</pre>

<p>
要求找到的变量赋值满足 <span class="underline">(and &lt;query1&gt;&lt;query2&gt; &#x2026; &lt;queryn&gt;)</span> 中的 <b>每个</b> 查询。比如找出所有程序员的住址：
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">and</span> <span style="color: #696969;">(</span>job ?person <span style="color: #696969;">(</span>computer programmer<span style="color: #696969;">))</span>
     <span style="color: #696969;">(</span>address ?person ?where<span style="color: #696969;">))</span>
</pre>
</div>

<p>
返回的响应是：
</p>
<pre class="example">
(and (job (Hacker Alyssa P) (computer programmer))
     (address (Hacker Alyssa P) (Cambridge (Mass Ave) 78)))
(and (job (Fect Cy D) (computer programmer))
     (address (Fect Cy D) (Cambridge (Ames Street) 3)))
</pre>
</div>
</div>

<div id="outline-container-org925c879" class="outline-5">
<h5 id="org925c879">or 查询</h5>
<div class="outline-text-5" id="text-org925c879">
<p>
or 复合的一般形式：
</p>
<pre class="example">
(or &lt;query1&gt;&lt;query2&gt; ... &lt;queryn&gt;)
</pre>

<p>
要求找出所有能满足 <span class="underline">(or &lt;query1&gt;&lt;query2&gt; &#x2026; &lt;queryn&gt;)</span>  <b>之一</b> 的赋值，给出用这些赋值实例化的结果。比如：得到由Ben Bitdiddle 或 Alyssa P. Hacker 管理的雇员名单：
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">or</span> <span style="color: #696969;">(</span>supervisor ?x <span style="color: #696969;">(</span>Bitdiddle Ben<span style="color: #696969;">))</span>
    <span style="color: #696969;">(</span>supervisor ?x <span style="color: #696969;">(</span>Hacker Alyssa P<span style="color: #696969;">)))</span>
</pre>
</div>

<p>
查询结果：
</p>
<pre class="example">
(or (supervisor (Hacker Alyssa P) (Bitdiddle Ben))
    (supervisor (Hacker Alyssa P) (Hacker Alyssa P)))
(or (supervisor (Fect Cy D) (Bitdiddle Ben))
    (supervisor (Fect Cy D) (Hacker Alyssa P)))
(or (supervisor (Tweakit Lem E) (Bitdiddle Ben))
    (supervisor (Tweakit Lem E) (Hacker Alyssa P)))
(or (supervisor (Reasoner Louis) (Bitdiddle Ben))
    (supervisor (Reasoner Louis) (Hacker Alyssa P)))
</pre>
</div>
</div>

<div id="outline-container-org8fe2639" class="outline-5">
<h5 id="org8fe2639">not 查询</h5>
<div class="outline-text-5" id="text-org8fe2639">
<p>
not 查询的一般形式为：
</p>
<pre class="example">
(not &lt;query&gt;)
</pre>

<p>
要求得到所有使 <span class="underline">&lt;query&gt;</span>   <b>不成立</b> 的赋值。比如，要求找出 Ben 管的所有人中的非程序员：
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">and</span> <span style="color: #696969;">(</span>supervisor ?x <span style="color: #696969;">(</span>Bitdiddle Ben<span style="color: #696969;">))</span>
     <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span>job ?x <span style="color: #696969;">(</span>computer programmer<span style="color: #696969;">))))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge2d4b18" class="outline-5">
<h5 id="orge2d4b18">lisp-value</h5>
<div class="outline-text-5" id="text-orge2d4b18">
<p>
<span class="underline">lisp-value</span> 的一般形式：
</p>
<pre class="example">
(lisp-value &lt;predicate&gt;&lt;arg1&gt; ... &lt;argn&gt;)
</pre>

<p>
第一参数 <span class="underline">&lt;predicate&gt;</span> 是一个Lisp 谓词。要求将 <b>谓词作用于后面的参数</b> （ <span class="underline">赋值后得到的值</span> ）， 选出使 <b>谓词为真</b> 的所有赋值。比如：选出所有工资高于 30000 的人
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">and</span> <span style="color: #696969;">(</span>salary ?person ?amount<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>lisp-value &gt; ?amount 30000<span style="color: #696969;">))</span>
</pre>
</div>

<p>
利用 <span class="underline">lisp-value</span>  可以很灵活地描述各种查询
</p>
</div>
</div>
</div>

<div id="outline-container-org3723c4c" class="outline-4">
<h4 id="org3723c4c">规则</h4>
<div class="outline-text-4" id="text-org3723c4c">
<p>
查询语言的 <b>抽象手段</b> 是 <span class="underline">建立规则</span> ，比如， <span class="underline">两个不同的人住得很近</span> 的规则就是：  <span class="underline">他们住在同一个town</span> 
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span>rule <span style="color: #696969;">(</span>lives-near ?person-1 ?person-2<span style="color: #696969;">)</span>
      <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">and</span> <span style="color: #696969;">(</span>address ?person-1 <span style="color: #696969;">(</span>?town . ?rest-1<span style="color: #696969;">))</span>
           <span style="color: #696969;">(</span>address ?person-2 <span style="color: #696969;">(</span>?town . ?rest-2<span style="color: #696969;">))</span>
           <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span>same ?person-1 ?person-2<span style="color: #696969;">))))</span>
</pre>
</div>

<p>
<span class="underline">同一个</span> 表达成规则：
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span>rule <span style="color: #696969;">(</span>same ?x ?x<span style="color: #696969;">))</span>
</pre>
</div>

<p>
组织里的大人物：如果被其管理的人还管别人 
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span>rule <span style="color: #696969;">(</span>wheel ?person<span style="color: #696969;">)</span>
      <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">and</span> <span style="color: #696969;">(</span>supervisor ?middle-manager ?person<span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span>supervisor ?x ?middle-manager<span style="color: #696969;">)))</span>
</pre>
</div>

<p>
规则的一般形式是：
</p>
<pre class="example">
(rule &lt;conclusion&gt; &lt;body&gt;)
</pre>

<p>
其中 <span class="underline">&lt;conclusion&gt;</span> 是 <b>模式</b> ， <span class="underline">&lt;body&gt;</span> 是任何形式的 <b>查询</b> 。可以认为一条规则表示了很大（甚至无穷大）的一个断言集，其元素是 <b>由 &lt;conclusion&gt;求出的所有满足&lt;body&gt; 的赋值</b> 
</p>

<p>
简单查询：
</p>
<ul class="org-ul">
<li>如果其中变量的某个赋值 <b>满足某查询模式</b> ，那么用这个赋值实例化模式得到的断言一定在数据库里</li>
<li>但满足规则的断言不一定实际存在在数据库里，有可能是推导出的事实</li>
</ul>

<p>
比如，找出所有住在 Bitdiddle Ben 附近的雇员：
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span>lives-near ?x <span style="color: #696969;">(</span>Bitdiddle Ben<span style="color: #696969;">))</span>
</pre>
</div>

<p>
返回结果：
</p>
<pre class="example">
(lives-near (Reasoner Louis) (Bitdiddle Ben))
(lives-near (Aull DeWitt) (Bitdiddle Ben))
</pre>

<p>
找出所有住在 Bitdiddle Ben 附近的程序员：
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">and</span> <span style="color: #696969;">(</span>job ?x <span style="color: #696969;">(</span>computer programmer<span style="color: #696969;">))</span>
     <span style="color: #696969;">(</span>lives-near ?x <span style="color: #696969;">(</span>Bitdiddle Ben<span style="color: #696969;">)))</span>
</pre>
</div>

<p>
与复合过程类似， <b>已定义的规则可以用于定义新规则</b> 。例如：
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span>rule <span style="color: #696969;">(</span>outranked-by ?staff-person ?boss<span style="color: #696969;">)</span>
      <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">or</span> <span style="color: #696969;">(</span>supervisor ?staff-person ?boss<span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #00bfff; font-weight: bold;">and</span> <span style="color: #696969;">(</span>supervisor ?staff-person ?middle-manager<span style="color: #696969;">)</span>
               <span style="color: #696969;">(</span>outranked-by ?middle-manager ?boss<span style="color: #696969;">))))</span>
</pre>
</div>

<p>
这是一条递归定义的规则： 
</p>
<ul class="org-ul">
<li><span class="underline">一个职员是某老板的下级</span></li>
<li><span class="underline">如果该老板是其主管，或者（递归的）其主管是该老板的下级</span></li>
</ul>
</div>
</div>

<div id="outline-container-org15196b6" class="outline-4">
<h4 id="org15196b6">逻辑程序</h4>
<div class="outline-text-4" id="text-org15196b6">
<p>
规则可看作 <span class="underline">逻辑蕴涵式</span> ： 若对 <span class="underline">所有模式变量的赋值能满足一条规则的身体</span> ，那么它就满足其结论。查询语言就是 <b>基于规则做逻辑推理</b> 
</p>

<p>
考虑 append 的例子，描述它的规则说：
</p>
<ul class="org-ul">
<li>对任何表 y，空表与它 append 得到的就是 y 本身</li>
<li>对任何表 u, v, y, z，(cons u v) 与 y 的 append 是 (cons u z) 的条件：v 与 y 的 append 是 z</li>
</ul>

<p>
用查询语言描述，需要 <b>描述关系</b>  (append-to-form x y z) ，直观解释是 “x 和 y 的拼接得到 z”。用规则定义是：
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #696969;">(</span>rule <span style="color: #696969;">(</span>append-to-form <span style="color: #696969;">()</span> ?y ?y<span style="color: #696969;">))</span>

<span style="color: #696969;">(</span>rule <span style="color: #696969;">(</span>append-to-form <span style="color: #696969;">(</span>?u . ?v<span style="color: #696969;">)</span> ?y <span style="color: #696969;">(</span>?u . ?z<span style="color: #696969;">))</span>
      <span style="color: #696969;">(</span>append-to-form ?v ?y ?z<span style="color: #696969;">))</span>
</pre>
</div>

<ol class="org-ol">
<li>第一条规则 <span class="underline">没有体</span> ，说明它 <b>对任何 y 成立</b></li>
<li>第二条规是 <b>递归定义</b> 的
<ul class="org-ul">
<li>注意：这里用了表的 <span class="underline">点号</span> 形式</li>
</ul></li>
</ol>

<p>
有了上面有关 <span class="underline">append-to-form</span>   的规则，可以做许多查询：
</p>

<p>
'(a b) 和 '(c d) 做 append 的结果
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #5f9ea0; font-style: italic;">;;; </span><span style="color: #5f9ea0; font-style: italic;">Query input:</span>
<span style="color: #696969;">(</span>append-to-form <span style="color: #696969;">(</span>a b<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>c d<span style="color: #696969;">)</span> ?z<span style="color: #696969;">)</span>
<span style="color: #5f9ea0; font-style: italic;">;;; </span><span style="color: #5f9ea0; font-style: italic;">Query results:</span>
<span style="color: #696969;">(</span>append-to-form <span style="color: #696969;">(</span>a b<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>c d<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>a b c d<span style="color: #696969;">))</span>
</pre>
</div>

<p>
什么和 '(a b) 做 append 会返回 '(a b c d)
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #5f9ea0; font-style: italic;">;;; </span><span style="color: #5f9ea0; font-style: italic;">Query input:</span>
<span style="color: #696969;">(</span>append-to-form <span style="color: #696969;">(</span>a b<span style="color: #696969;">)</span> ?y <span style="color: #696969;">(</span>a b c d<span style="color: #696969;">))</span>
<span style="color: #5f9ea0; font-style: italic;">;;; </span><span style="color: #5f9ea0; font-style: italic;">Query results:</span>
<span style="color: #696969;">(</span>append-to-form <span style="color: #696969;">(</span>a b<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>c d<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>a b c d<span style="color: #696969;">))</span>
</pre>
</div>

<p>
x 和 y 做 append 会返回 '(a b c d)， x, y 的值是什么：
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #5f9ea0; font-style: italic;">;;; </span><span style="color: #5f9ea0; font-style: italic;">Query input:</span>
<span style="color: #696969;">(</span>append-to-form ?x ?y <span style="color: #696969;">(</span>a b c d<span style="color: #696969;">))</span>
<span style="color: #5f9ea0; font-style: italic;">;;; </span><span style="color: #5f9ea0; font-style: italic;">Query results:</span>
<span style="color: #696969;">(</span>append-to-form <span style="color: #696969;">()</span> <span style="color: #696969;">(</span>a b c d<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>a b c d<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span>append-to-form <span style="color: #696969;">(</span>a<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>b c d<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>a b c d<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span>append-to-form <span style="color: #696969;">(</span>a b<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>c d<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>a b c d<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span>append-to-form <span style="color: #696969;">(</span>a b c<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>d<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>a b c d<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span>append-to-form <span style="color: #696969;">(</span>a b c d<span style="color: #696969;">)</span> <span style="color: #696969;">()</span> <span style="color: #696969;">(</span>a b c d<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orga080a14" class="outline-2">
<h2 id="orga080a14">实现</h2>
</div>
</div>
<div id="postamble" class="status">

		  <br/>
		  <div class='ds-thread'></div>
		  <script>
		  var duoshuoQuery = {short_name:'klose911'};
		  (function() {
					  var dsThread = document.getElementsByClassName('ds-thread')[0];
					  dsThread.setAttribute('data-thread-key', document.title);
					  dsThread.setAttribute('data-title', document.title);
					  dsThread.setAttribute('data-url', window.location.href);
					  var ds = document.createElement('script');
					  ds.type = 'text/javascript';ds.async = true;
					  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
					  ds.charset = 'UTF-8';
					  (document.getElementsByTagName('head')[0] 
						|| document.getElementsByTagName('body')[0]).appendChild(ds);
					  })();
		  </script>
		  <script>
		  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
		  ga('create', 'UA-90850421-1', 'auto');
		  ga('send', 'pageview');
		  </script>
</div>
</body>
</html>
